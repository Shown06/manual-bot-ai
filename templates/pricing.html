{% extends "base.html" %}
{% block title %}æ–™é‡‘ãƒ—ãƒ©ãƒ³ - Manual Bot AI{% endblock %}
{% block content %}
<div class="header">
    <h1>æ–™é‡‘ãƒ—ãƒ©ãƒ³</h1>
    <p>ã‚ãªãŸã®ãƒ“ã‚¸ãƒã‚¹ã«æœ€é©ãªãƒ—ãƒ©ãƒ³ã‚’ãŠé¸ã³ãã ã•ã„</p>
    {% if session.user_id %}
    <div class="nav">
        <a href="/dashboard">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
        <a href="/logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>
    {% endif %}
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
    {% for plan in plans %}
    <div class="card" style="text-align: center;">
        <h2>{{ plan.name }}</h2>
        <div style="font-size: 36px; font-weight: bold; color: #667eea; margin: 20px 0;">
            {{ plan.price }}
            <span style="font-size: 16px; color: #666;">/æœˆ</span>
        </div>
        <ul style="list-style: none; padding: 0; margin: 20px 0;">
            {% for feature in plan.features %}
            <li style="padding: 8px 0;">âœ“ {{ feature }}</li>
            {% endfor %}
        </ul>
        {% if session.user_id %}
        <button class="btn" onclick="subscribe('{{ plan.price_id }}')">
            ã“ã®ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ
        </button>
        {% else %}
        <a href="/register" class="btn">ç™»éŒ²ã—ã¦å§‹ã‚ã‚‹</a>
        {% endif %}
    </div>
    {% endfor %}
</div>

<div class="card" style="margin-top: 40px; text-align: center;">
    <p>ğŸ‰ å…¨ãƒ—ãƒ©ãƒ³7æ—¥é–“ã®ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä»˜ã</p>
    <p>ã„ã¤ã§ã‚‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½</p>
</div>

<script>
async function subscribe(priceId) {
    // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    const response = await fetch('/api/auth/check');
    const auth = await response.json();
    
    if (!auth.authenticated) {
        alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
        window.location.href = '/login?next=/pricing';
        return;
    }
    try {
        const response = await fetch('/create-checkout-session', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ price_id: priceId })
        });
        
        const data = await response.json();
        
        if (data.checkout_url) {
            window.location.href = data.checkout_url;
        } else {
            alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
}
</script>
{% endblock %}
